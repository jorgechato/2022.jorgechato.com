<!doctype html><html lang=en><head><meta charset=utf-8><title>The CHEAPEST server ever, a Platform journey Vol.2 |
jorgechato</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://jorgechato.comindex.xml title=jorgechato><link rel=icon type=image/png href=/img/favicon.png><meta name=twitter:card content="summary"><meta name=twitter:title content="The CHEAPEST server ever, a Platform journey Vol.2"><meta name=twitter:description content="A Platform journey is a series of articles with the goal of discussing the
architecture, integration patterns, automatisation and chaos engineering of my current
platform."><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-146816931-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><header class="header bg-header w-full text-sm flex items-center sticky top-0 z-20"><div class="header-wrap mx-auto flex items-center flex-auto px-4 w-full max-w-extreme"><div class="header-left mr-5 flex flex-none items-center"><a href=/ class="header-logo inline-block leading-none godo-tracking" data-event-category=Header data-event-action=Logo data-event-label=Click data-event-non-interaction=true><span class="text-2xl font-bold">jorgechato</span></a></div><nav class="header-center mainMenu relative flex items-center pr-5 flex-grow overflow-auto lg:overflow-visible"><ul itemscope itemtype=http://www.schema.org/SiteNavigationElement class="nav whitespace-no-wrap hidden lg:flex"><li itemprop=name class=ml-5><a itemprop=url href=https://noaptoen.asia/ class="mainMenu-link godo-tracking hover:text-primary font-medium" data-event-category=Header data-event-action=Menu data-event-non-interaction=true>Podcast</a></li><li itemprop=name class=ml-5><a itemprop=url href=/tags/hack class="mainMenu-link godo-tracking hover:text-primary font-medium" data-event-category=Header data-event-action=Menu data-event-non-interaction=true>Hacking</a></li><li itemprop=name class=ml-5><a itemprop=url href=/tags/code class="mainMenu-link godo-tracking hover:text-primary font-medium" data-event-category=Header data-event-action=Menu data-event-non-interaction=true>Coding</a></li><li itemprop=name class=ml-5><a itemprop=url href=/author/jorge class="mainMenu-link godo-tracking hover:text-primary font-medium" data-event-category=Header data-event-action=Menu data-event-non-interaction=true>About me</a></li><li class="dropdown is-hoverable ml-5 hidden"><a href=# class="mainMenu-link dropdown-trigger hover:text-primary font-medium"><span>More</span><svg class="icon is-small transform rotate-90"><use xlink:href="#icon-arrow-forward"/></svg></a><div class="dropdown-menu whitespace-normal"><div class=dropdown-content><div class=js-dropdown-menu></div><hr class=dropdown-divider><div class="js-social-media social-media social-media"><a href=https://twitter.com/jorgechato title=undefined class="hover:text-twitter p-2 inline-block" target=_blank rel="noopener noreferrer"><em class="fab fa-twitter" data-fa-transform=shrink--6></em></a>
<a href=https://github.com/jorgechato title=undefined class="hover:text-github p-2 inline-block" target=_blank rel="noopener noreferrer"><em class="fab fa-github" data-fa-transform=shrink--6></em></a>
<a href=https://www.linkedin.com/in/jorgechato/ title=undefined class="hover:text-linkedin p-2 inline-block" target=_blank rel="noopener noreferrer"><em class="fab fa-linkedin" data-fa-transform=shrink--6></em></a></div></div></div></li></ul></nav><div class="header-right flex-none flex justify-end items-center u-menu-color"><a class="js-dark-mode button is-white items-center hidden mr-2 md:flex custom-control-input" aria-label="Dark and Light Mode"><em class="fas fa-adjust" data-fa-transform=shrink--6></em></a>
<a href=javascript:; aria-label="Toggle Search" class="js-modal-button hidden godo-tracking button is-white mr-2" data-target=modal-search aria-haspopup=true data-event-category=Header data-event-action=Search data-event-label=Click data-event-non-interaction=true><em class="fas fa-search" data-fa-transform=shrink--6></em></a><div class="js-menu-toggle menu-burger button is-white relative ml-2 lg:hidden"><span></span><span></span><span></span></div></div></div></header><div class="nav-mob fixed inset-0 pt-16 pb-5 bg-header h-screen z-10 w-full text-center lg:hidden"><div class="nav-mob-wrap absolute inset-0 top-16 py-5 overflow-auto flex justify-between flex-col"><div class="py-4 flex justify-center md:hidden buttons"><a class="js-dark-mode button is-white items-center mr-2 md:flex custom-control-input" aria-label="Dark and Light Mode"><em class="fas fa-adjust" data-fa-transform=shrink--6></em></a></div><div class=py-4><ul><li><a href=https://noaptoen.asia/ class="block px-5 py-2 font-medium text-22 leading-tight">Podcast</a></li><li><a href=/tags/hack class="block px-5 py-2 font-medium text-22 leading-tight">Hacking</a></li><li><a href=/tags/code class="block px-5 py-2 font-medium text-22 leading-tight">Coding</a></li><li><a href=/author/jorge class="block px-5 py-2 font-medium text-22 leading-tight">About me</a></li></ul></div><div class="js-social-media social-media nav-mob-social-media social-media is-inline py-4"><a href=https://twitter.com/jorgechato title=undefined class="hover:text-twitter p-2 inline-block" target=_blank rel="noopener noreferrer"><em class="fab fa-twitter" data-fa-transform=shrink--6></em></a>
<a href=https://github.com/jorgechato title=undefined class="hover:text-github p-2 inline-block" target=_blank rel="noopener noreferrer"><em class="fab fa-github" data-fa-transform=shrink--6></em></a>
<a href=https://www.linkedin.com/in/jorgechato/ title=undefined class="hover:text-linkedin p-2 inline-block" target=_blank rel="noopener noreferrer"><em class="fab fa-linkedin" data-fa-transform=shrink--6></em></a></div></div></div><div class="post-header px-4 mx-auto max-w-740 relative z-3 pt-8"><div class=intro-header><div class=post-heading><div class="mb-3 text-gray-400 tracking-wider text-sm font-medium"><a title=code href=https://jorgechato.com/tags/code/>CODE
</a>&nbsp;
<a title=pipeline href=https://jorgechato.com/tags/pipeline/>PIPELINE
</a>&nbsp;
<a title=platform-journey href=https://jorgechato.com/tags/platform-journey/>PLATFORM-JOURNEY
</a>&nbsp;
<a title=frontend href=https://jorgechato.com/tags/frontend/>FRONTEND
</a>&nbsp;
<a title=vue href=https://jorgechato.com/tags/vue/>VUE
</a>&nbsp;
<a title=javascript href=https://jorgechato.com/tags/javascript/>JAVASCRIPT
</a>&nbsp;
<a title=github href=https://jorgechato.com/tags/github/>GITHUB
</a>&nbsp;
<a title=nuxt href=https://jorgechato.com/tags/nuxt/>NUXT
</a>&nbsp;</div><h1 class="post-title text-32 md:text-4xl lg:text-44 text-title">The CHEAPEST server ever, a Platform journey Vol.2</h1><div class="post-excerpt mt-6 text-22 text-gray-500"><p>A Platform journey is a series of articles with the goal of discussing the
architecture, integration patterns, automatisation and chaos engineering of my current
platform.</p></div><div class="meta hh flex items-center relative z-4 flex-auto leading-snug overflow-hidden"><ul class="hh-author flex flex-wrap flex-none mr-3"><li class="hh-author-item realtive"><span class="relative block avatar is-45x45"><a href=https://jorgechato.com/author/jorge/><img class="no-zoom absolute u-image block rounded-full" src="https://avatars.githubusercontent.com/u/4450555?v=4" alt="Go to the profile of Jorge"></a></span></li></ul><div class="hh-right flex-auto overflow-hidden"><div class="hh-author-name text-sm noWrapWithEllipsis"><a href=https://jorgechato.com/author/jorge/>Jorge</a></div><div class="hh-date flex items-center text-gray-500 text-sm">23 Apr 2020
<span class="bull mx-1">Â·</span>
5 min read</div></div></div></div></div></div><div class="post-wrap max-w-1100 relative mx-auto"><div class="px-4 mx-auto max-w-740 relative" role=main><article class="article post-body" id=post-body><p>You are provably aware of the current infrastructure and programming pattern I am building for this series <strong><em><a href=/tag/platform-journey/>a platform journey</a></em></strong> (I will cover extra details in future volumes). More specifically, we already discussed the limitations of it and the overall picture in <a href=/how-to-destroy-your-aws-services/>Volume 1</a>. Volume 2 will explain the thought process of building one of the cheapest components of the platform as well as the technical side of the application.</p><p>Since this article is a set of skills, from integration patters to CI/CD pipelines and secrets configuration. This <em>TOC</em> will help you to navigate through and skip the sections you already master.</p><h2>Table of content</h2><nav id=TableOfContents><ul><li><a href=#integration-pattern>Integration pattern</a></li><li><a href=#setting-the-github-token>Setting the Github Token</a></li><li><a href=#pipeline-in-travis-cicd>Pipeline in Travis (CI/CD)</a></li><li><a href=#dns-management>DNS management</a></li><li><a href=#s3-vs-github-pages>S3 vs Github Pages</a></li><li><a href=#s3-alternative-with-terraform>S3 alternative with Terraform</a></li></ul></nav><h2 id=integration-pattern>Integration pattern</h2><p><strong>Nuxt</strong>, one of the most popular <strong>Vue</strong> frameworks for new web apps. One of the most important Nuxt configurations is the mode, as it determines how your app is built, deployed and served. There are three main types of web apps out there today:</p><ol><li>Classic Single-Page App (SPA)</li><li>Universal/Isomorphic Web App (UWA)</li><li>Pre-Rendered Single-Page App</li></ol><p>Today we are going to focus on <strong>SPA</strong>. **** In a classic SPA, the HTML served to the client is relatively empty, and JavaScript dynamically renders HTML once it gets to the client.</p><p>One of the <strong>PRO</strong>s for this mode is building static files, making it easy to deploy to a <strong>CDN</strong> (content delivery network).</p><figure><img src=/img/2019/09/Screenshot-2019-09-22-at-13.26.49.png></figure><p><em>Github pages</em> will serve a Single Page application. All the api calls will go through a <strong>Golang API REST</strong> server which may or may not have external dependencies to build the data model.</p><h2 id=setting-the-github-token>Setting the Github Token</h2><p>Before going deep into the pipeline, let&rsquo;s create some important assets. Youâll need to generate a personal access token with the <strong>public_repo</strong> or <strong>repo</strong> scope (<strong>repo</strong> is required for private repositories).</p><p>Go to <a href=https://github.com/settings/tokens/new>https://github.com/settings/tokens/new</a> <em>(Settings > Developer settings > Personal access tokens)</em> and generate a new token.</p><figure><img src=/img/2019/09/Screenshot-2019-09-22-at-11.12.00.png></figure><p>Since the token should be <strong>private</strong>, youâll want to pass it to Travis <strong>securely</strong> in your <a href=https://docs.travis-ci.com/user/environment-variables#defining-variables-in-repository-settings>repository settings</a> or via <a href=https://docs.travis-ci.com/user/environment-variables#defining-encrypted-variables-in-travisyml>encrypted variables</a> in .travis.yml.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>cd</span> &lt;repository-folder&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># login for travis.com</span>
</span></span><span class=line><span class=cl>$ travis login --com
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># secret for travis.com</span>
</span></span><span class=line><span class=cl>$ travis encrypt --pro <span class=nv>GITHUB_ACCESS_TOKEN</span><span class=o>=</span>xxx --add
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># secret for travis.org</span>
</span></span><span class=line><span class=cl>$ travis encrypt --org <span class=nv>GITHUB_ACCESS_TOKEN</span><span class=o>=</span>xxx --add
</span></span></code></pre></div><h2 id=pipeline-in-travis-cicd>Pipeline in Travis (CI/CD)</h2><p>Travis CI can deploy your static files to <a href=https://pages.github.com/>GitHub Pages</a> after a successful build. Depending on the Work Flow that fit your needs you might want to change the deployment branch. GitHub flow is a lightweight, branch-based workflow and you can know more about it in <a href=https://guides.github.com/introduction/flow/>this article</a>.</p><figure><img src=/img/2019/09/Screenshot-2019-09-22-at-13.38.17.png></figure><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>dist</span><span class=p>:</span><span class=w> </span><span class=l>trusty</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>language</span><span class=p>:</span><span class=w> </span><span class=l>node_js</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>node_js</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=s1>&#39;8&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>global</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>secure</span><span class=p>:</span><span class=w> </span><span class=m>5</span><span class=l>+tJXzbTwC6Q8A9XHifJODwOU4NHYsVpWdTzXKz4Ea/16a7hBeB5HUKyvJqy3Ld+3MzLSnIBZbXKYqB1a8ixtyYkzdLbIr0opbJVZcSR3q/3h5Gq1bw/FJsB5dFtjXip5DPvXATPcDCcZrghsoH831q7qt2segCjTIyeC4hWvPihCsKk/GxyzZaeJznLBQd3FXfEHziU3AhS5Krn+EzTlVtRRqi13In8mv0OGI9wGEeHHCA60GvvRDX1O+up8ttwCVWocWO/tsEGoYXdvaG7YYWtpgIplOzrEu0eN98nVHT+6HkBFuiSPazFiSPDYvwPsYjyq2mzPkuItcaOSbQxPYfmBYgcvqJoiD+uiNFgk5HeXBs+Tsj0r7VWsJ3HKp7V0lKFWgIUyaABdnzftAhDHGEwvovAqNCzTOr/0FM2omyDxJn6t5RyvevPugDVI2Twi57moCYVkY8ykyBDq45VQeYarTs2J8Vx5IxnYpzo6BSvRt8kN4xmcZ6IRxzEK05Q59THiI85xeiYwLaeIXmQ9rG211gyRmehxeKgDaRJm8lrFYwlpB/UCvlzp6sSGmGiJhpWUpXIAfrhLwoL7iEfAnB4oH1ZVTgVujAldhwIdwpcn1G5FQAhiKDVVG4uuu54cAVd6GpawFW3BTca9uP05t61rZFCliWYNglEwauOsCM=</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>cache</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>directories</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>node_modules</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>only</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=l>master</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>install</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>npm install</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=l>npm run generate</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>script</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># TODO: ADD your tests here</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=c># - test</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>provider</span><span class=p>:</span><span class=w> </span><span class=l>pages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>skip-cleanup</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>github-token</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;$GITHUB_ACCESS_TOKEN&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>target-branch</span><span class=p>:</span><span class=w> </span><span class=l>gh-pages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>local-dir</span><span class=p>:</span><span class=w> </span><span class=l>dist</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>fqdn</span><span class=p>:</span><span class=w> </span><span class=l>&lt;DNS&gt;</span><span class=w> </span><span class=c># Optional, add the custom domain to the configuration of the Github pages</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>on</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>branch</span><span class=p>:</span><span class=w> </span><span class=l>master</span><span class=w>
</span></span></span></code></pre></div><h2 id=dns-management>DNS management</h2><p>Github Pages allows you to add custom domains, and since 2018 Let&rsquo;s Encrypt is available in the configuration.</p><blockquote><p>We have partnered with the certificate authority <a href=https://letsencrypt.org/>Letâs Encrypt</a> on this project. As supporters of Letâs Encryptâs mission to make the web more secure for everyone, weâve officially become Silver-level sponsors of the initiative.</p></blockquote><p>If you are using <code>CNAME</code> or <code>ALIAS</code> records for your custom domain, youâre all set and your site should be accessible over HTTPS. If it is, and your site loads correctly over HTTPS, <a href=https://help.github.com/articles/securing-your-github-pages-site-with-https/>you can optionally enforce HTTPS in your repositoryâs settings</a>. Users who request your site over HTTP will be upgraded to HTTPS.</p><p>In this section though we will cover the <code>A</code> records. Follow your DNS provider&rsquo;s instructions to create <code>A</code> records that point your custom domain to the following IP addresses:</p><ul><li>185.199.108.153</li><li>185.199.109.153</li><li>185.199.110.153</li><li>185.199.111.153</li></ul><p>We delegate to the CI/CD pipeline, add the custom domain to the configuration of the Github pages.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Confirm that your DNS record is set up correctly</span>
</span></span><span class=line><span class=cl>$ dig +noall +answer &lt;DNS&gt;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>&lt;DNS&gt;.	1799	IN	A	185.199.111.153
</span></span><span class=line><span class=cl>&lt;DNS&gt;.	1799	IN	A	185.199.108.153
</span></span><span class=line><span class=cl>&lt;DNS&gt;.	1799	IN	A	185.199.110.153
</span></span><span class=line><span class=cl>&lt;DNS&gt;.	1799	IN	A	185.199.109.153
</span></span></code></pre></div><h2 id=s3-vs-github-pages>S3 vs Github Pages</h2><p>First thing that come to my mind, and since the core of the platform is hosted on AWS, was deploying the frontend into a <em>S3 bucket + <a href=https://aws.amazon.com/en/cloudfront/>Cloudfront</a> + <a href=https://aws.amazon.com/en/certificate-manager/>ACM</a></em> (amazon certificate manager).</p><p>S3 is a static storage which can be configured for Static Site Hosting. Cloudfront is a <strong>CDN</strong> (content delivery network) and you can configure the cache time and availability zones you want to serve files from.</p><p>Cloundfront offers free HTTPS certs, in the other hand if you need a DNS customisation, ACM allow us to automate and renewal a <strong>SSL</strong> <strong>certificate</strong> for our custom domains for free.</p><p>In the end the cost will be in the <a href=https://aws.amazon.com/en/cloudfront/pricing/>Cloudfront side</a> + a small fee from <a href=https://aws.amazon.com/en/s3/pricing/>S3</a>.</p><blockquote><p>*Please <a href=https://calculator.s3.amazonaws.com/index.html>calculate</a> the cost by your own first.</p></blockquote><p>Github Pages has a few <strong>limitations:</strong></p><ul><li>lack of scalability</li><li>only available for public repositories (7$ for private ones, <strong>more</strong> <strong>expensive</strong> than <em>S3</em> <em>solution</em>)</li><li>Low cache expires (GitHub sets the cache-control: max-age header to 600 seconds, or ten minutes)</li></ul><p>For the sake of simplicity in the deployment, pipeline integration and isolation from the rest of the platform the Github Pages&rsquo; constraints are a side effect that I&rsquo;m willing to take.</p><h2 id=s3-alternative-with-terraform>S3 alternative with Terraform</h2><p>I am aware we didn&rsquo;t talk about <strong>Terrform</strong> just yet, but let me share with you some snippets and overall picture of what TF can do for us.</p><blockquote><p><em><strong>Terraform</strong></em> enables you to safely and predictably create, change, and improve infrastructure.</p></blockquote><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># terraform.tfvars</span>
</span></span><span class=line><span class=cl><span class=nv>bucket_name</span> <span class=o>=</span> <span class=s2>&#34;my-spa-&lt;my-service-name&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>domain</span>      <span class=o>=</span> <span class=s2>&#34;&lt;my-dns&gt;&#34;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=c># policy.json</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;Id&#34;: </span><span class=s2>&#34;bucket_policy_site&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;Version&#34;: </span><span class=s2>&#34;2012-10-17&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>&#34;Statement&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>{<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Sid&#34;: </span><span class=s2>&#34;bucket_policy_site_main&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Action&#34;: </span><span class=p>[</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=s2>&#34;s3:GetObject&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=p>],</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Effect&#34;: </span><span class=s2>&#34;Allow&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Resource&#34;: </span><span class=s2>&#34;arn:aws:s3:::${var.bucket_name}/*&#34;</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>&#34;Principal&#34;: </span><span class=s2>&#34;*&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=p>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>}<span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># S3</span>
</span></span><span class=line><span class=cl>resource <span class=s2>&#34;aws_s3_bucket&#34;</span> <span class=s2>&#34;spa&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>bucket</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>var</span><span class=p>.bucket_name</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>acl</span>    <span class=o>=</span> <span class=s2>&#34;public-read&#34;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=nv>policy</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>file</span><span class=p>(</span><span class=s2>&#34;policy.json&#34;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Versioning is not needed and if it is enable the cost will increase</span>
</span></span><span class=line><span class=cl>  versioning <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>enabled</span> <span class=o>=</span> <span class=nb>false</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=c1># Prevent to destroy the S3 bucket on any update or purge</span>
</span></span><span class=line><span class=cl>  lifecycle <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>prevent_destroy</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  website <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>index_document</span> <span class=o>=</span> <span class=s2>&#34;index.html&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>error_document</span> <span class=o>=</span> <span class=s2>&#34;index.html&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>tags</span>   <span class=o>=</span>  <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>Name</span> <span class=o>=</span> <span class=s2>&#34;SPA whereisjorge.today&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># Cloudfront</span>
</span></span><span class=line><span class=cl>resource <span class=s2>&#34;aws_cloudfront_distribution&#34;</span> <span class=s2>&#34;spa&#34;</span> <span class=o>{</span>  
</span></span><span class=line><span class=cl>  origin <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>domain_name</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>aws_s3_bucket</span><span class=p>.spa.bucket_domain_name</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=nv>origin_id</span>   <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>var</span><span class=p>.bucket_name</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>enabled</span>             <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl>  <span class=nv>is_ipv6_enabled</span>     <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl>  <span class=nv>default_root_object</span> <span class=o>=</span> <span class=s2>&#34;index.html&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nv>aliases</span> <span class=o>=</span> <span class=o>[</span><span class=s2>&#34;</span><span class=si>${</span><span class=nv>var</span><span class=p>.domain</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># ACM</span>
</span></span><span class=line><span class=cl>resource <span class=s2>&#34;aws_acm_certificate&#34;</span> <span class=s2>&#34;my-acm&#34;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=nv>domain_name</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>var</span><span class=p>.domain</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nv>subject_alternative_names</span> <span class=o>=</span> <span class=o>[</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;</span><span class=si>${</span><span class=nv>var</span><span class=p>.domain</span><span class=si>}</span><span class=s2>&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;www.</span><span class=si>${</span><span class=nv>var</span><span class=p>.domain</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>  <span class=o>]</span>
</span></span><span class=line><span class=cl>  <span class=c1># Check the ACM documentation on how to validate your DNS</span>
</span></span><span class=line><span class=cl>  <span class=nv>validation_method</span> <span class=o>=</span> <span class=s2>&#34;DNS&#34;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  lifecycle <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>create_before_destroy</span> <span class=o>=</span> <span class=nb>true</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># We will skip the validation of the acm since my DNS provider doesn&#39;t have an automatic provider/free API to add new records.</span>
</span></span><span class=line><span class=cl><span class=c1># NAMECHEAP really?</span>
</span></span></code></pre></div><button onclick=topFunction() id=backtotopButton>
<em class="fa fa-angle-up"></em></button>
<script>document.addEventListener("scroll",function(){document.body.scrollTop>50||document.documentElement.scrollTop>50?(document.getElementById("backtotopButton").style.opacity="1",document.getElementById("backtotopButton").style.transition="0.5s"):(document.getElementById("backtotopButton").style.opacity="0",document.getElementById("backtotopButton").style.transition="0.5s")});function topFunction(){document.body.scrollTop=0,document.documentElement.scrollTop=0}</script><div class="post-tags mb-8"><div class=buttons><a class="button is-light font-medium text-sm capitalize godo-tracking" href=https://jorgechato.com/tags/code/>code
</a>&nbsp;
<a class="button is-light font-medium text-sm capitalize godo-tracking" href=https://jorgechato.com/tags/pipeline/>pipeline
</a>&nbsp;
<a class="button is-light font-medium text-sm capitalize godo-tracking" href=https://jorgechato.com/tags/platform-journey/>platform-journey
</a>&nbsp;
<a class="button is-light font-medium text-sm capitalize godo-tracking" href=https://jorgechato.com/tags/frontend/>frontend
</a>&nbsp;
<a class="button is-light font-medium text-sm capitalize godo-tracking" href=https://jorgechato.com/tags/vue/>vue
</a>&nbsp;
<a class="button is-light font-medium text-sm capitalize godo-tracking" href=https://jorgechato.com/tags/javascript/>javascript
</a>&nbsp;
<a class="button is-light font-medium text-sm capitalize godo-tracking" href=https://jorgechato.com/tags/github/>github
</a>&nbsp;
<a class="button is-light font-medium text-sm capitalize godo-tracking" href=https://jorgechato.com/tags/nuxt/>nuxt
</a>&nbsp;</div></div></article><div class="prev-next pb-8"><hr class=my-10><div class="flex relative godo-tracking mb-8" data-event-category=Article data-event-action="Previous article" data-event-non-interaction=true><div class="prev-next-body pl-6 flex-auto"><a href=https://jorgechato.com/the-power-of-dockers-micro-images-a-golang-journey-vol.1/><div class="text-sm leading-none text-gray-500 mb-2 font-medium">Previous article</div><h2 class="prev-next-title text-title mb-2 text-xl md:text-22">The power of docker's MICRO images, a Golang journey Vol.1</h2><p class="prev-next-excerpt text-base text-gray-500 lineClamp-2 leading-snug">A Golang journey is a series of articles about golang as microservice.
It is a complementary set for the platform journey series.
In this first volume we will cover the docker images and CI/CD pipeline.</p></a></div></div><div class="flex relative godo-tracking" data-event-category=Article data-event-action="Next article" data-event-non-interaction=true><div class="prev-next-body pl-6 flex-auto"><a href=https://jorgechato.com/traveling-with-a-hacker-vol.1/><div class="text-sm leading-none text-gray-500 mb-2 font-medium">Next article</div><h2 class="prev-next-title text-title mb-2 text-xl md:text-22">Traveling with a HACKER Vol.1</h2><p class="prev-next-excerpt text-base text-gray-500 lineClamp-2 leading-snug">I am now on my vacations traveling around Japan.
As I always do as soon as I'm connected to a wifi,
the first thing is turning my personal VPN on.
This time though, I wanted to know how bad the security in some venues are.
Tokyo edition.</p></a></div></div></div></div></div><footer class="footer-light py-10 lg:pt-16 text-center lg:text-left"><div class="mx-auto max-w-extreme px-4"><div class="flex flex-col lg:flex-row justify-between"><div class="footer-copy text-sm order-3 mt-8 flex-none lg:text-left lg:order-none lg:mt-0">&copy; 2020
<a href=https://jorgechato.com>jorgechato</a>.
All rights reserved.<div class=mt-2>Design with <span class="icon animated infinite pulse">â¤ï¸</span>by
<a href=https://jorgechato.com/ class=link>@JorgeChato</a>.
<a href=https://github.com/jorgechato/hution>Hution</a> Theme.</div></div><div class="js-social-media social-media footer-social-media mt-8 flex-none lg:mt-0 is-inline"><div class="js-social-media social-media footer-social-media flex-none lg:mt-0 is-inline"><a href=https://twitter.com/jorgechato target=_blank class="hover:text-twitter p-2 inline-block" name=twitter><em class="fab fa-twitter" data-fa-transform=shrink--6></em></a>
<a href=https://github.com/jorgechato target=_blank class="hover:text-github p-2 inline-block" name=github><em class="fab fa-github" data-fa-transform=shrink--6></em></a>
<a href=https://www.linkedin.com/in/jorgechato/ target=_blank class="hover:text-linkedin p-2 inline-block" name=linkedin><em class="fab fa-linkedin" data-fa-transform=shrink--6></em></a>
<link rel=stylesheet href=https://jorgechato.com/css/main.css><link rel=stylesheet href=https://jorgechato.com/css/base.css><link rel=stylesheet href=https://jorgechato.com/css/github.css><link rel=stylesheet href=https://jorgechato.com/css/zooming.css><script>let darkMode=localStorage.getItem("theme");darkMode==="dark"&&document.documentElement.classList.add("dark")</script><script src=https://jorgechato.com/js/main.js></script>
<script src=https://jorgechato.com/js/zooming.min.js></script>
<script src=https://jorgechato.com/js/fontawesome.all.min.js></script>
<script>document.addEventListener("DOMContentLoaded",function(){new Zooming({bgColor:"var(--bg)",bgOpacity:.5,scaleBase:.9}).listen("figure>img:not(.no-zoom)")})</script><meta name=generator content="Hugo 0.101.0"></div></div></footer></body></html>